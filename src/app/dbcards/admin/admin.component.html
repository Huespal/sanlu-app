<h1 translate="ADMIN.HEADER"></h1>

<md-tab-group>
    <md-tab label="{{ 'ADMIN.CHARACTERS' | translate }}">
        <!-- Card form -->
        <form *ngIf="isCreating || isEditing" [formGroup]="cardForm" (ngSubmit)="onSubmitForm()" >

            <!-- Name -->
            <md-input-container>
                <label for="card-name" translate="ADMIN.NAME"></label>
                <input id="card-name" formControlName="cardName"
                       (keyup)="onChangeCardName()"
                       mdInput min="2"/>
            </md-input-container>

            <!-- Type -->
            <md-select class="white-select" formControlName="cardType" placeholder="{{ 'ADMIN.SERIES' | translate }}" (change)="onChangeCardType()">
                <md-option [value]="cardTypes.DB">{{ 'ADMIN.DB' | translate }}</md-option>
                <md-option [value]="cardTypes.Z">{{ 'ADMIN.Z' | translate }}</md-option>
                <md-option [value]="cardTypes.GT">{{ 'ADMIN.GT' | translate }}</md-option>
            </md-select>

            <!-- Picture -->
            <div class="flex-container"
                 fxLayout="row"
                 fxLayoutAlign="start start">

                <div class="card-picture-container">
                    <label for="card-picture" translate="ADMIN.PICTURE" class="card-picture-label"></label>
                    <input id="card-picture" type="file" accept="image/*" (change)="onChangeCardPicture($event)"/>
                </div>

                <!-- Picture preview -->
                <img *ngIf="!!formImgPreview" src="{{ formImgPreview }}">
            </div>

            <!-- Energy -->
            <md-input-container>
                <label for="card-energy" translate="ADMIN.ENERGY"></label>
                <input id="card-energy" min="0" type="number" formControlName="cardEnergy" mdInput (keyup)="onChangeCardEnergy()"/>
            </md-input-container>

            <!-- Attacks -->
            <div formArrayName="cardAttacks">
                <md-input-container  *ngFor="let attack of cardForm.get('cardAttacks').controls; let i=index" [formGroupName]="i">
                    <label for="card-attack-{{i+1}}">{{ 'ADMIN.ATTACK' | translate }} {{ i+1 }}</label>
                    <input id="card-attack-{{i+1}}" formControlName="attack" mdInput (keyup)="onChangeCardAttack()"/>
                </md-input-container>
            </div>

            <!-- Has extra attack checkbox -->
            <md-checkbox *ngIf="!cardForm.controls.hasExtraAttack.value" formControlName="hasExtraAttack">{{ 'ADMIN.ATTACK' | translate }}  {{ 'ADMIN.EXTRA' | translate | lowercase }}</md-checkbox>

            <!-- Extra Attack -->
            <md-input-container *ngIf="cardForm.controls.hasExtraAttack.value">
                <label for="card-attack-extra">{{ 'ADMIN.ATTACK' | translate }} {{ 'ADMIN.EXTRA' | translate | lowercase }}</label>
                <input id="card-attack-extra" formControlName="cardAttackExtra" mdInput/>
            </md-input-container>
            <button *ngIf="cardForm.controls.hasExtraAttack.value" md-icon-button (click)="onCancelExtraAttack()"><i class="material-icons">&#xE5CD;</i></button>

            <!-- Creating controls -->
            <div *ngIf="isCreating"
                 class="flex-container"
                 fxLayout="row"
                 fxLayoutAlign="start start">
                <button md-button (click)="isCreating = false">{{ 'DIALOG.CANCEL' | translate }}</button>
                <button md-button [disabled]="!cardForm.valid">{{ 'ADMIN.CREATE' | translate }}</button>
            </div>

            <!-- Editing controls -->
            <div *ngIf="isEditing"
                 class="flex-container"
                 fxLayout="row"
                 fxLayoutAlign="start start">
                <button md-button (click)="isEditing = false">{{ 'DIALOG.CANCEL' | translate }}</button>
                <button md-button [disabled]="!cardForm.valid">{{ 'ADMIN.EDIT' | translate }}</button>
            </div>
        </form>

        <!-- Search -->
        <form *ngIf="charactersList.length > 0"
              [formGroup]="searchForm"
              class="flex-container"
              fxLayout="row"
              fxLayoutAlign="start start">
            <md-input-container>
                <label for="card-search" translate="ADMIN.SEARCH"></label>
                <input id="card-search"
                       mdInput
                       formControlName="searchInput"
                       (keyup)="onSearchCard()"/>
            </md-input-container>
        </form>

        <div class="flex-container"
             fxLayout="row"
             fxLayoutAlign="start start">

            <!-- Create card -->
            <button md-button class="new-card" *ngIf="!isCreating && !isEditing" (click)="onShowCreateCardForm()" title="{{ 'ADMIN.NEW' | translate }}">
                <i class="material-icons">&#xE145;</i>
            </button>

            <!-- Cards list -->
            <app-card *ngFor="let character of charactersList; index as i;" [character]="character" [isAdmin]="true" (cardEvent)="handleCardEvent($event)" class="card"></app-card>
        </div>
    </md-tab>
    <md-tab label="{{ 'ADMIN.OTHERS' | translate }}">
        TODO: Non-character cards
    </md-tab>
</md-tab-group>